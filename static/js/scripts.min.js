function initialize(){null!=localStorage.getItem("token")&&getMe()}function login(){var e=document.getElementById("email").value,t=document.getElementById("password").value;""!=e&&""!=t?$.ajax({type:"POST",url:"api/auth",data:{email:e,password:t}}).done(function(e){e.isSuccess?(localStorage.setItem("token",e.token),getMe(),$("#loginModal").modal("hide"),closeLoginModal()):document.getElementById("login-error-label").innerHTML=e.message}).fail(function(e){document.getElementById("login-error-label").innerHTML="An error occured, please try again."}):document.getElementById("login-error-label").innerHTML="Please fill out all the boxes."}function logout(){localStorage.clear(),sessionStorage.clear(),x=document.getElementById("loggedOutPanel"),x.style.display="block",x=document.getElementById("loggedInPanel"),x.style.display="none",x=document.getElementById("addEvent"),x.style.display="none",x=document.getElementById("addEventItem"),x.style.display="none",$("#logoutModal").modal("hide")}function signup(){var e=document.getElementById("name").value,t=document.getElementById("mail").value,n=document.getElementById("pwd").value,a=document.getElementById("repwd").value;""!=e&&""!=t&&""!=n&&""!=a?n==a?$.ajax({type:"POST",url:"api/auth/register",data:{name:e,email:t,password:n,repassword:a}}).done(function(e){e.isSuccess?$.ajax({type:"POST",url:"api/auth",data:{email:t,password:n}}).done(function(e){e.isSuccess?(localStorage.setItem("token",e.token),getMe(),$("#signupModal").modal("hide"),closeSignupModal()):document.getElementById("register-error-label").innerHTML=e.message}).fail(function(e){document.getElementById("register-error-label").innerHTML="An error occured, please try again."}):document.getElementById("register-error-label").innerHTML=e.message}).fail(function(e){document.getElementById("register-error-label").innerHTML="An error occured, please try again."}):document.getElementById("register-error-label").innerHTML="Control your password.":document.getElementById("register-error-label").innerHTML="Please fill all the boxes."}function getMe(){$.ajax({type:"GET",url:"api/auth/me",headers:{authorization:localStorage.getItem("token")}}).done(function(e){if(e.isSuccess){sessionStorage.id=e.data.id,sessionStorage.name=e.data.name,document.getElementById("username").innerHTML=e.data.name;var t=document.getElementById("addEvent");t.style.display="block",(t=document.getElementById("addEventItem")).style.display="inline",(t=document.getElementById("loggedOutPanel")).style.display="none",(t=document.getElementById("loggedInPanel")).style.display="block"}}).fail(function(e){console.log(e)})}function getStatistics(){$.ajax({type:"GET",url:"api/categories/count"}).done(function(e){e.isSuccess&&(document.getElementById("categoryCount").innerHTML=e.data.categoryCount)}).fail(function(e){console.log(e)}),$.ajax({type:"GET",url:"api/auth/count"}).done(function(e){e.isSuccess&&(document.getElementById("activeUserCount").innerHTML=e.data.userCount)}).fail(function(e){console.log(e)}),$.ajax({type:"GET",url:"api/events/count"}).done(function(e){e.isSuccess&&(document.getElementById("eventCount").innerHTML=e.data.eventCount)}).fail(function(e){console.log(e)})}function getCategories(){var e="",t="";$.ajax({type:"GET",url:"api/categories",headers:{"Cache-Control":"public, max-age = 86400"},cache:!0}).done(function(n){n.isSuccess?($("#category").empty(),$.each(n.data.categories,function(){e+='<li class="category col-sm-4"><img src="'+this.picture+'" alt="image" class="img-rounded"><a href="#" onclick="return false;"><span>'+this.name+"</span></a></li>",t='<option value="'+this._id+'">'+this.name+"</option>",$("#categoryList").html(e),$("#category").append(t)})):console.log(n.message)}).fail(function(e){console.log(e)})}function getEvents(){$.ajax({type:"GET",url:"api/events"}).done(function(e){var t="";e.isSuccess&&$.each(e.data.events,function(){t+='<li style="cursor:pointer; margin: 10px" onclick="getEventDetail(\''+this.id+'\')"><div class="date"><a href="#"><span class="day">'+this.day+'</span><span class="month">'+this.month+'</span><span class="year">'+this.year+'</span></a></div><a href="#"><img src="'+this.photo+'" alt="image"></a><div class="info"><p>'+this.title+" <span>"+this.city+"</span></p></div></li>",document.getElementById("eventsPanel").innerHTML=t})}).fail(function(e){document.getElementById("login-error-label").innerHTML="An error occured, please try again."})}function getEventDetail(e){$.ajax({type:"GET",url:"/api/eventDetail/"+e}).done(function(e){var t="none";e.isSuccess&&(e.data.userId==sessionStorage.id&&(t="block"),content='<div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">'+e.data.title+'</h4></div><div class="modal-body"><img class="col-12 col-md-4" src="'+e.data.photo+'" alt="image"><p style="font-weight: bold; font-size: 20px; margin:0">'+e.data.title+"-"+e.data.userName+'</p><p style="margin:0">'+e.data.start+'</p><p style="margin:0">'+e.data.address+'</p><div col-12 col-md-12><p style="margin: 10px; margin-top: 30px">'+e.data.content+'</p></div></div><div class="modal-footer"><button type="button" class="btn btn-danger btn-default pull-left" style="margin-left: 10px; display: '+t+'" onclick="deleteEvent(\''+e.data.id+'\');"><span class="glyphicon glyphicon-trash"></span> Delete</button><button type="submit" class="btn btn-primary btn-default pull-right" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancel</button></div>',document.getElementById("eventDetail").innerHTML=content,$("#eventDetailModal").modal())}).fail(function(e){console.log(e)})}function deleteEvent(e){$.ajax({type:"POST",url:"api/events/"+e,headers:{authorization:localStorage.getItem("token")}}).done(function(e){e.isSuccess?($("#eventDetailModal").modal("hide"),getEvents()):console.log(e.message)}).fail(function(e){console.log(e)})}function addEvent(){var e=document.getElementById("eventName").value,t=document.getElementById("date").value,n=document.getElementById("city").value,a=document.getElementById("town").value,o=document.getElementById("fullAddress").value,l=document.getElementById("photo").files[0],d=document.getElementById("content").value,i=document.getElementById("category").value,s=$("#category option:selected").text();if(""!=e&&""!=t&&""!=n&&""!=a&&""!=o&&""!=l&&void 0!=l&&null!=l&&""!=d&&""!=s){var c=new FormData;c.append("File",l),$.ajax({url:"https://evantapp.azurewebsites.net/api/events/photo",type:"POST",data:c,cache:!1,contentType:!1,processData:!1}).done(function(c){l=c.message;var r={title:e,start:t,city:n,town:a,fullAddress:o,photo:l,content:d,user:{id:sessionStorage.id,userName:sessionStorage.name},category:{id:i,categoryName:s}};$.ajax({type:"POST",data:r,url:"api/events",headers:{authorization:localStorage.getItem("token")}}).done(function(e){e.isSuccess?(document.getElementById("add-error-label").innerHTML="",clearAddEventForm(),getEvents()):document.getElementById("add-error-label").innerHTML=e.message}).fail(function(e){document.getElementById("add-error-label").innerHTML="An error occured, please try again."})}).fail(function(e,t,n){document.getElementById("add-error-label").innerHTML=n})}else document.getElementById("add-error-label").innerHTML="Please fill out all the boxes."}function closeLoginModal(){document.getElementById("email").value="",document.getElementById("password").value="",document.getElementById("login-error-label").innerHTML=""}function closeSignupModal(){document.getElementById("name").value="",document.getElementById("mail").value="",document.getElementById("pwd").value="",document.getElementById("repwd").value="",document.getElementById("register-error-label").innerHTML=""}function clearAddEventForm(){document.getElementById("eventName").value="",document.getElementById("date").value="",document.getElementById("city").value="",document.getElementById("town").value="",document.getElementById("fullAddress").value="",document.getElementById("photo").files[0]="",document.getElementById("content").value="",document.getElementById("category").value="",document.getElementById("add-error-label").innerHTML=""}initialize(),getEvents(),getStatistics();